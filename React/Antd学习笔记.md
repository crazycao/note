# Antdå­¦ä¹ ç¬”è®°

> **Ant Design React å’Œ Ant Design Pro æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ**
> å¯ä»¥ç†è§£ä¸º Ant Design React æ˜¯ä¸€å¥— React ç»„ä»¶åº“ï¼Œè€Œ Pro æ˜¯ä½¿ç”¨äº†è¿™å¥—ç»„ä»¶åº“çš„å®Œæ•´å‰ç«¯è„šæ‰‹æ¶ã€‚

## å®‰è£…
æ–°å»ºä¸€ä¸ª **ç©ºçš„** æ–‡ä»¶å¤¹ä½œä¸ºé¡¹ç›®ç›®å½•ï¼Œå¹¶åœ¨ç›®å½•ä¸‹æ‰§è¡Œï¼š

```
npm create umi
```
å±å¹•ä¼šå‡ºç°å¦‚ä¸‹é€‰é¡¹ï¼Œè¯·é€‰æ‹© `ant-design-pro`ã€‚

```
Select the boilerplate type (Use arrow keys)
â¯ ant-design-pro  - Create project with an layout-only ant-design-pro boilerplate, use together with umi block.
  app             - Create project with a simple boilerplate, support typescript.
  block           - Create a umi block.
  library         - Create a library with umi.
  plugin          - Create a umi plugin.
```

ç„¶åï¼Œå®‰è£…ç¨‹åºä¼šè¯¢é—®ä½ æ˜¯å¦æ–°æ‰‹ã€‚å¦‚æœå†™ `y`ï¼Œé‚£å°±ä¼šæŒ‰ç…§é»˜è®¤é…ç½®è‡ªåŠ¨å®‰è£…è„šæ‰‹æ¶ï¼›å†™ `N` åˆ™è¿›å…¥è‡ªå®šä¹‰é…ç½®ã€‚ 

```
? ğŸ§™ Be the first to experience the new umi@3 ? (y/N) 
```

ä¸ºäº†è¯´æ˜é…ç½®æƒ…å†µï¼Œæˆ‘ä»¬é€‰æ‹© `N`ã€‚ç„¶åå®‰è£…å™¨ç»§ç»­è¯¢é—®ä½¿ç”¨å“ªç§è¯­è¨€ã€‚é»˜è®¤é…ç½®ä¸­æ˜¯ `TypeScript`ã€‚ç„¶è€Œï¼Œå¦‚æœä½ åªä¼š `JavaScript` å°±åˆ«é€å¼ºã€‚

```
? ğŸ¤“ Which language do you want to use? (Use arrow keys)
â¯ TypeScript 
  JavaScript 
```

å®‰è£…å™¨æ¥ä¸‹æ¥é—®æ˜¯è¦å®‰è£…æ‰€æœ‰çš„æ¨¡å—ï¼Œè¿˜æ˜¯åªæ˜¯ä¸€ä¸ªç®€å•çš„è„šæ‰‹æ¶ã€‚é»˜è®¤é…ç½®ä¸­æ˜¯ `simple`ã€‚ä¸ªäººä¹ æƒ¯æ˜¯å…ˆå®‰è£…å®Œæ•´çš„ï¼Œç„¶åå†æ…¢æ…¢åˆ é™¤ã€‚å½“ç„¶ä¹Ÿå¯ä»¥å…ˆå®‰è£…ç®€å•çš„å†æ…¢æ…¢æ·»åŠ ã€‚

```
? ğŸš€ Do you need all the blocks or a simple scaffold? (Use arrow keys)
â¯ simple 
  complete 
```

æœ€åä¸€ä¸ªè¯¢é—®çš„é—®é¢˜ï¼Œä½œè€…åœ¨å®‰åˆ©ä½ ç”¨ `antd@4`ã€‚ç”¨æœ€æ–°ç‰ˆçš„æ¡†æ¶ä¹Ÿæ²¡ä»€ä¹ˆä¸å¥½ï¼Œå°±é€‰ `Y`ã€‚é€‰ `n` çš„è¯å°±å®‰è£… `antd@3`ï¼Œç„¶è€Œå¯èƒ½å®‰è£…å¤±è´¥â€¦â€¦

```
? ğŸ¦„ Time to use better, faster and latest antd@4! (Y/n) 
```

ç»ˆäºå¼€å§‹è‡ªåŠ¨å®‰è£…ï¼Œæ‰€ä»¥ä¸€å¼€å§‹å°±æ‰¿è®¤è‡ªå·±æ˜¯æ–°æ‰‹å°±çœå¿ƒå¾ˆå¤šã€‚æœ€åå‡ºç°ä¸‹é¢çš„è¾“å‡ºè¯´æ˜å·²ç»å®‰è£…å®Œæˆã€‚

```
> ğŸšš clone success
> [Sylvanas] Prepare js environment...
> [JS] Clean up...
> Clean up...
âœ¨ File Generate Done
```

## ç›®å½•ç»“æ„

```
â”œâ”€â”€ config                   # umi é…ç½®ï¼ŒåŒ…å«è·¯ç”±ï¼Œæ„å»ºç­‰é…ç½®
â”œâ”€â”€ mock                     # æœ¬åœ°æ¨¡æ‹Ÿæ•°æ®
â”œâ”€â”€ public
â”‚   â””â”€â”€ favicon.png          # Favicon
â”œâ”€â”€ src
â”‚   â”œâ”€â”€ assets               # æœ¬åœ°é™æ€èµ„æº
â”‚   â”œâ”€â”€ components           # ä¸šåŠ¡é€šç”¨ç»„ä»¶
â”‚   â”œâ”€â”€ e2e                  # é›†æˆæµ‹è¯•ç”¨ä¾‹
â”‚   â”œâ”€â”€ layouts              # é€šç”¨å¸ƒå±€
â”‚   â”œâ”€â”€ models               # å…¨å±€ dva model
â”‚   â”œâ”€â”€ pages                # ä¸šåŠ¡é¡µé¢å…¥å£å’Œå¸¸ç”¨æ¨¡æ¿
â”‚   â”œâ”€â”€ services             # åå°æ¥å£æœåŠ¡
â”‚   â”œâ”€â”€ utils                # å·¥å…·åº“
â”‚   â”œâ”€â”€ locales              # å›½é™…åŒ–èµ„æº
â”‚   â”œâ”€â”€ global.less          # å…¨å±€æ ·å¼
â”‚   â””â”€â”€ global.ts            # å…¨å±€ JS
â”œâ”€â”€ tests                    # æµ‹è¯•å·¥å…·
â”œâ”€â”€ README.md
â””â”€â”€ package.json
```

## ESlint

```
npm install eslint --save-dev
npm install eslint-plugin-react --save-dev
```

## å¸ƒå±€

é¡µé¢æ•´ä½“å¸ƒå±€æ˜¯ä¸€ä¸ªäº§å“æœ€å¤–å±‚çš„æ¡†æ¶ç»“æ„ï¼Œå¾€å¾€ä¼šåŒ…å«å¯¼èˆªã€é¡µè„šã€ä¾§è¾¹æ ã€é€šçŸ¥æ ä»¥åŠå†…å®¹ç­‰ã€‚

åœ¨ Ant Design Pro ä¸­ï¼Œæˆ‘ä»¬æŠ½ç¦»äº†ä½¿ç”¨è¿‡ç¨‹ä¸­çš„é€šç”¨å¸ƒå±€ï¼Œéƒ½æ”¾åœ¨ layouts ç›®å½•ä¸­ï¼Œåˆ†åˆ«ä¸ºï¼š

- BasicLayoutï¼šåŸºç¡€é¡µé¢å¸ƒå±€ï¼ŒåŒ…å«äº†å¤´éƒ¨å¯¼èˆªï¼Œä¾§è¾¹æ å’Œé€šçŸ¥æ ã€‚
- UserLayoutï¼šæŠ½ç¦»å‡ºç”¨äºç™»å½•æ³¨å†Œé¡µé¢çš„é€šç”¨å¸ƒå±€ã€‚
- BlankLayoutï¼šç©ºç™½çš„å¸ƒå±€ã€‚

## è·¯ç”±

ç›®å‰è„šæ‰‹æ¶ä¸­æ‰€æœ‰çš„è·¯ç”±éƒ½é€šè¿‡ `config.ts` æ¥ç»Ÿä¸€ç®¡ç†ã€‚

é…ç½®è§„åˆ™å‚è§ [Umiè·¯ç”±](./Umi/Umiè·¯ç”±.md) ï¼ˆhttps://umijs.org/zh-CN/docs/routingï¼‰ã€‚æ”¯æŒä»¥ä¸‹ä¸»è¦å‚æ•°ï¼š

- `path` è·¯ç”±è·¯å¾„ã€‚ç”¨äºä¸ `url` åŒ¹é…ã€‚å¯ä»¥åŒ…å«é€šé…ç¬¦ã€‚
- `component` è·¯ç”±ç»„ä»¶ã€‚é…ç½®ç”¨äºæ¸²æŸ“çš„ React ç»„ä»¶è·¯å¾„ã€‚å¯ä»¥æ˜¯ç»å¯¹è·¯å¾„ï¼Œä¹Ÿå¯ä»¥æ˜¯ç›¸å¯¹è·¯å¾„ã€‚
- `exact` æ˜¯å¦ä¸¥æ ¼åŒ¹é…ã€‚é»˜è®¤ `false`ï¼Œ`url` ä¸­åŒ…å« `path` å³å¯åŒ¹é…ä¸Šï¼›å¦åˆ™éœ€è¦å®Œå…¨ç›¸åŒæ‰èƒ½åŒ¹é…æˆåŠŸã€‚
- `redirect` é…ç½®è·¯ç”±è·³è½¬ã€‚è®¿é—® `path` æ—¶åˆ™ä¼šè·³è½¬åˆ° `redirect` æŒ‡å®šçš„å¦ä¸€ä¸ªè·¯ç”±ã€‚
- `routes` å­è·¯ç”±ã€‚æ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œæ•°ç»„å†…æ¯ä¸ªå…ƒç´ éƒ½æ˜¯ä¸€ä¸ªè·¯ç”±ï¼Œå¯ä»¥å¾ªç¯ä¸‹å»ã€‚

Antd åœ¨ umi çš„é…ç½®ä¸­æˆ‘ä»¬å¢åŠ äº†ä¸€äº›å‚æ•°ï¼Œæ¥è¾…åŠ©ç”Ÿæˆèœå•ã€‚

- `name` å’Œ `icon` åˆ†åˆ«ä»£è¡¨ç”Ÿæˆèœå•é¡¹çš„æ–‡æœ¬å’Œå›¾æ ‡ã€‚
- `hideChildrenInMenu` ç”¨äºéšè—ä¸éœ€è¦åœ¨èœå•ä¸­å±•ç¤ºçš„å­è·¯ç”±ã€‚
- `hideInMenu` å¯ä»¥åœ¨èœå•ä¸­ä¸å±•ç¤ºè¿™ä¸ªè·¯ç”±ï¼ŒåŒ…æ‹¬å­è·¯ç”±ã€‚
- `authority` ç”¨æ¥é…ç½®è¿™ä¸ªè·¯ç”±çš„æƒé™ï¼Œå¦‚æœé…ç½®äº†å°†ä¼šéªŒè¯å½“å‰ç”¨æˆ·çš„æƒé™ï¼Œå¹¶å†³å®šæ˜¯å¦å±•ç¤ºã€‚

## èœå•
æ ¹æ®è·¯ç”±é…ç½®æ¥ç”Ÿæˆèœå•ã€‚èœå•é¡¹åç§°ï¼ŒåµŒå¥—è·¯å¾„ä¸è·¯ç”±é«˜åº¦è€¦åˆã€‚

å¯ä»¥é…ç½® `hideInMenu: true` è®©æŸäº›è·¯ç”±åœ¨èœå•ä¸­ä¸æ˜¾ç¤ºã€‚

å¯ä»¥åœ¨ `src/layouts/BasicLayout.tsx` ä¸­ä¿®æ”¹ `menuDataRender`ï¼Œå¹¶åœ¨ä»£ç ä¸­å‘èµ· `http` è¯·æ±‚ï¼Œåªéœ€æœåŠ¡å™¨è¿”å›è·¯ç”±é…ç½®æ ¼å¼çš„ json å³å¯ã€‚

## é¢åŒ…å±‘

é¢åŒ…å±‘ç”± `PageHeaderWrapper` å®ç°ã€‚

`PageHeaderWrapper` å¿…é¡»è¦è¢« `ProLayout` åŒ…è£¹æ‰èƒ½è‡ªåŠ¨ç”Ÿæˆé¢åŒ…å±‘å’Œæ ‡é¢˜ã€‚

## Mock

çº¦å®š `/mock` æ–‡ä»¶å¤¹ä¸‹æ‰€æœ‰æ–‡ä»¶ä¸º `mock` æ–‡ä»¶ã€‚

é€šå¸¸æŠŠæ¯ä¸€ä¸ªæ•°æ®æ¨¡å‹æŠ½è±¡æˆä¸€ä¸ªæ–‡ä»¶ï¼Œç»Ÿä¸€æ”¾åœ¨ `mock` çš„æ–‡ä»¶å¤¹ä¸­ï¼Œç„¶åä»–ä»¬ä¼šè‡ªåŠ¨è¢«å¼•å…¥ã€‚

æ–‡ä»¶å¯¼å‡ºæ¥å£å®šä¹‰ï¼Œæ”¯æŒåŸºäº `require` åŠ¨æ€åˆ†æçš„å®æ—¶åˆ·æ–°ï¼Œæ”¯æŒ ES6 è¯­æ³•ï¼Œä»¥åŠå‹å¥½çš„å‡ºé”™æç¤ºã€‚

```
export default {
  // æ”¯æŒå€¼ä¸º Object å’Œ Array
  'GET /api/users': { users: [1, 2] },

  // GET POST å¯çœç•¥
  '/api/users/1': { id: 1 },

  // æ”¯æŒè‡ªå®šä¹‰å‡½æ•°ï¼ŒAPI å‚è€ƒ express@4
  'POST /api/users/create': (req, res) => {
    res.end('OK');
  },
};
```

å½“å®¢æˆ·ç«¯ï¼ˆæµè§ˆå™¨ï¼‰å‘é€è¯·æ±‚ï¼Œå¦‚ï¼š`GET /api/users`ï¼Œé‚£ä¹ˆæœ¬åœ°å¯åŠ¨çš„ umi dev ä¼šè·Ÿæ­¤é…ç½®æ–‡ä»¶åŒ¹é…è¯·æ±‚è·¯å¾„ä»¥åŠæ–¹æ³•ï¼Œå¦‚æœåŒ¹é…åˆ°äº†ï¼Œå°±ä¼šå°†è¯·æ±‚é€šè¿‡é…ç½®å¤„ç†ã€‚

### å¼•å…¥ Mock.ts

```
import mockjs from 'mockjs';

export default {
  // ä½¿ç”¨ mockjs ç­‰ä¸‰æ–¹åº“
  'GET /api/tags': mockjs.mock({
    'list|100': [{ name: '@city', 'value|1-100': 50, 'type|0-2': 1 }],
  }),
};
```

### æ·»åŠ è·¨åŸŸè¯·æ±‚å¤´

```
'POST /api/users/create': (req, res) => {
  ...
  res.setHeader('Access-Control-Allow-Origin', '*');
  ...
},
```

### æ‰‹åŠ¨æ·»åŠ  setTimeout æ¨¡æ‹Ÿå»¶è¿Ÿ

```
'POST /api/forms': (req, res) => {
  setTimeout(() => {
    res.send('Ok');
  }, 1000);
},
```

### ä½¿ç”¨æ’ä»¶æ¨¡æ‹Ÿå»¶è¿Ÿï¼ˆæ‰¹é‡æ¥å£ï¼‰

```
import { delay } from 'roadhog-api-doc';

const proxy = {
  'GET /api/project/notice': getNotice,
  'GET /api/tags': mockjs.mock({
    'list|100': [{ name: '@city', 'value|1-100': 50, 'type|0-2': 1 }],
  }),
  'GET /api/fake_list': getFakeList,
  'POST /api/register': (req, res) => {
    res.send({ status: 'ok' });
  },
  'GET /api/notices': getNotices,
};

// è°ƒç”¨ delay å‡½æ•°ï¼Œç»Ÿä¸€å¤„ç†
export default delay(proxy, 1000);
```

### å…³é—­ mock

- æ–¹æ³•ä¸€ï¼šé€šè¿‡ç¯å¢ƒå˜é‡ä¸´æ—¶å…³é—­

	```
	npm run start:no-mock
	```
	
	å®é™…æ˜¯
	
	```
	MOCK=none umi dev
	```
	
- æ–¹æ³•äºŒï¼šé€šè¿‡é…ç½®å…³é—­

	```
	export default {
  		mock: false,
	};
	```
