# Block 对变量的捕获

参考文章：[https://zhuanlan.zhihu.com/p/151399818](https://zhuanlan.zhihu.com/p/151399818)

**为了保证 block 内部能正常访问外部变量，block 有个变量捕获机制：**

| 变量类型 | 捕获到 block 内部 | 访问方式 |
|:-:|:-:|:-:|
| 局部变量 | 是 | 值传递 |
| 局静态变量 | 是 | 指针传递 |
| 全局变量 | 否 | 直接访问 |

- **局部变量，值截获**

对于 block 外的变量引用，block 默认是将其复制到其数据结构中（自动变量截获）来实现访问的。

自动变量截获只针对 block 内部使用的变量，不使用则不截获。（这是由于 block 截获的变量会存储于 block 的结构体内部，会导致 block 体积变大。）

默认情况下 block 只能访问，不能修改局部变量的值。（因为访问的是复制到其数据结构内的值。）

自动变量截获发生于 block 初始化的瞬间，因此在默认情况下，在定义 block 之后再修改局部变量的值，并不能影响 block 中自动变量的值。

- **局部静态变量，指针截获**

静态变量是用静态变量的指针来对其进行访问的，因此 block 也截获局部静态变量的指针。因此，在定义 block 之后修改静态变量的值是有效的；在 block 中也可以修改静态变量的值。

- **全局变量、静态全局变量，不截获，直接取值**

从 block 语法转换成的 C 语言函数中访问静态全局变量/全局变量并没有任何改变，可以直接使用。


